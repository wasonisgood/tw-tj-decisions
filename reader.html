<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËΩâÂûãÊ≠£Áæ©Ê±∫ÂÆöÊõ∏Èñ±ËÆÄÂô®</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f9f7f1; /* Paper-like off-white */
            --sidebar-bg: #2c3e50;
            --sidebar-hover: #34495e;
            --sidebar-active: #c0392b;
            --sidebar-text: #ecf0f1;
            --text-color: #2c3e50;
            --accent-color: #c0392b; /* Official seal red */
            --border-color: #dcd6cc;
            --font-serif: 'Noto Serif TC', serif;
            --font-sans: 'Noto Sans TC', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-sans);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        aside {
            width: 350px;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            flex-shrink: 0;
            z-index: 10;
        }

        .sidebar-header {
            padding: 20px;
            background-color: rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .sidebar-header h1 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: 700;
            letter-spacing: 1px;
            color: #fff;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 10px 10px 35px;
            border: none;
            border-radius: 4px;
            background-color: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 0.9rem;
            outline: none;
            transition: background 0.2s;
        }

        .search-input:focus {
            background-color: rgba(255,255,255,0.2);
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.5);
            font-size: 0.8rem;
        }

        .case-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .case-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: background-color 0.2s, padding-left 0.2s;
        }

        .case-item:hover {
            background-color: var(--sidebar-hover);
            padding-left: 25px;
        }

        .case-item.active {
            background-color: rgba(255,255,255,0.1);
            border-left: 4px solid var(--accent-color);
        }

        .case-id {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .case-subject {
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .empty-state {
            padding: 20px;
            text-align: center;
            color: rgba(255,255,255,0.4);
            font-size: 0.9rem;
        }

        /* Main Content */
        main {
            flex: 1;
            position: relative;
            overflow: hidden; /* Use internal scroll container */
            display: flex;
            flex-direction: column;
        }
        
        /* Metadata Header Bar (in main view) */
        .meta-bar {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            padding: 15px 40px;
            display: flex;
            gap: 40px;
            font-size: 0.9rem;
            color: #666;
            flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .meta-item strong {
            color: #333;
            margin-right: 5px;
        }

        .content-scroll-container {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 40px 60px;
        }

        .document-container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            padding: 60px 80px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            min-height: 100%;
        }

        .doc-header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 20px;
        }

        .doc-title {
            font-family: var(--font-serif);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #000;
        }

        .doc-subtitle {
            font-family: var(--font-serif);
            font-size: 1.2rem;
            color: #555;
        }

        /* Main Text (‰∏ªÊñá) Box */
        .main-text-box {
            background-color: #fdf2f2;
            border-left: 5px solid var(--accent-color);
            padding: 20px 30px;
            margin-bottom: 40px;
            font-family: var(--font-serif);
            font-size: 1.1rem;
            line-height: 1.8;
            color: #2c3e50;
        }

        .main-text-label {
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 10px;
            display: block;
        }

        /* Reasoning Content */
        .content-section {
            font-family: var(--font-serif);
            line-height: 1.8;
            color: #333;
        }

        .level-1 {
            font-size: 1.4rem;
            font-weight: 700;
            margin-top: 40px;
            margin-bottom: 20px;
            color: #000;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .level-2 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 25px;
            margin-bottom: 15px;
            color: #444;
            padding-left: 0;
        }

        .level-3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #555;
            padding-left: 0; 
        }
        
        .level-4, .level-5 {
            font-size: 1rem;
            font-weight: 600;
            margin-top: 15px;
            color: #666;
        }

        .text-paragraph {
            margin-bottom: 15px;
            text-align: justify;
            font-size: 1.05rem;
        }

        .indent-1 { margin-left: 0; }
        .indent-2 { margin-left: 1.5em; }
        .indent-3 { margin-left: 3em; }

        /* Tables */
        .table-container {
            margin-top: 40px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px 15px;
            text-align: left;
            vertical-align: top;
        }

        th {
            background-color: #f4f4f4;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
        }

        tr:nth-child(even) {
            background-color: #fafafa;
        }
        
        /* Highlight match */
        .highlight {
            background-color: #ffe066;
            color: #000;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            aside { width: 100%; height: 300px; }
            main { height: auto; }
            .content-scroll-container { padding: 20px; }
            .document-container { padding: 30px 20px; }
            .meta-bar { flex-direction: column; gap: 10px; padding: 15px 20px; }
        }
    </style>
</head>
<body>

<aside>
    <div class="sidebar-header">
        <h1>Ê±∫ÂÆöÊõ∏Ê™¢Á¥¢</h1>
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" id="search-input" placeholder="ÊêúÂ∞ãÊ°àËôü„ÄÅÁï∂‰∫ã‰∫∫...">
        </div>
    </div>
    <div class="case-list" id="case-list">
        <!-- List items injected here -->
    </div>
</aside>

<main>
    <div class="meta-bar">
        <div class="meta-item">
            <strong>ÁôºÊñáÂ≠óËôü:</strong> <span id="meta-case-no">-</span>
        </div>
        <div class="meta-item">
            <strong>Áï∂‰∫ã‰∫∫:</strong> <span id="meta-subject">-</span>
        </div>
        <div class="meta-item">
            <strong>Êó•Êúü:</strong> <span id="meta-date">-</span>
        </div>
    </div>

    <div class="content-scroll-container" id="scroll-container">
        <div class="document-container" id="doc-container">
            <!-- Content will be injected here -->
            <div class="doc-header">
                <div class="doc-title">‰øÉÈÄ≤ËΩâÂûãÊ≠£Áæ©ÂßîÂì°ÊúÉÊ±∫ÂÆöÊõ∏</div>
                <div class="doc-subtitle">Ë´ãÂæûÂ∑¶ÂÅ¥ÂàóË°®ÈÅ∏ÊìáÊ°à‰ª∂</div>
            </div>
        </div>
    </div>
</main>

<!-- Load Data -->
<script src="decision_data.js"></script>

<script>
    // --- DOM Elements ---
    const caseListEl = document.getElementById('case-list');
    const searchInput = document.getElementById('search-input');
    const container = document.getElementById('doc-container');
    const scrollContainer = document.getElementById('scroll-container');
    const metaCaseNo = document.getElementById('meta-case-no');
    const metaSubject = document.getElementById('meta-subject');
    const metaDate = document.getElementById('meta-date');

    let allCases = []; // To store data from window.DECISIONS_DATA

    // --- Render Functions ---

    function renderMetadata(meta) {
        metaCaseNo.textContent = meta.case_no || 'Êú™Ë®òËºâ';
        metaSubject.textContent = meta.subject || 'Êú™Ë®òËºâ';
        metaDate.textContent = meta.date || 'Êú™Ë®òËºâ';
    }

    function renderReasoningRecursively(items, containerDiv) {
        if (!items || items.length === 0) return;

        items.forEach(item => {
            const wrapper = document.createElement('div');
            
            // Render Header based on level
            if (item.text) {
                const level = item.level || 3;
                const header = document.createElement(level === 1 ? 'h2' : (level === 2 ? 'h3' : (level === 3 ? 'h4' : 'h5')));
                header.className = `level-${level} indent-${Math.max(0, level - 1)}`;
                header.textContent = item.text;
                wrapper.appendChild(header);
            }

            // Render content paragraphs
            if (item.content && item.content.length > 0) {
                item.content.forEach(paraText => {
                    const p = document.createElement('p');
                    p.className = 'text-paragraph indent-' + (item.level || 1);
                    p.textContent = paraText;
                    wrapper.appendChild(p);
                });
            }

            // Recursion for children
            if (item.children && item.children.length > 0) {
                renderReasoningRecursively(item.children, wrapper);
            }

            containerDiv.appendChild(wrapper);
        });
    }

    function renderTables(tables, containerDiv) {
        if (!tables || tables.length === 0) return;

        const tableSection = document.createElement('div');
        tableSection.className = 'table-container';
        
        const header = document.createElement('h3');
        header.className = 'level-2';
        header.textContent = 'ÈôÑË°® / Áõ∏ÈóúË°®Ê†º';
        tableSection.appendChild(header);

        tables.forEach(tbl => {
            const tableEl = document.createElement('table');
            const tbody = document.createElement('tbody');

            tbl.data.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                row.forEach(cellText => {
                    const cell = document.createElement(rowIndex === 0 ? 'th' : 'td');
                    cell.textContent = cellText;
                    tr.appendChild(cell);
                });
                tbody.appendChild(tr);
            });

            tableEl.appendChild(tbody);
            tableSection.appendChild(tableEl);
        });

        containerDiv.appendChild(tableSection);
    }

    function renderDocument(data) {
        // Clear container
        container.innerHTML = '';
        scrollContainer.scrollTop = 0; // Reset scroll

        // 1. Header
        const headerDiv = document.createElement('div');
        headerDiv.className = 'doc-header';
        
        const titleDiv = document.createElement('div');
        titleDiv.className = 'doc-title';
        titleDiv.textContent = '‰øÉÈÄ≤ËΩâÂûãÊ≠£Áæ©ÂßîÂì°ÊúÉÊ±∫ÂÆöÊõ∏';
        
        const subTitleDiv = document.createElement('div');
        subTitleDiv.className = 'doc-subtitle';
        subTitleDiv.textContent = data.filename ? data.filename.replace('.json', '').replace('.pdf', '') : (data.metadata.case_no || '');

        headerDiv.appendChild(titleDiv);
        headerDiv.appendChild(subTitleDiv);
        container.appendChild(headerDiv);

        // 2. Main Text (‰∏ªÊñá)
        if (data.content && data.content.main_text) {
            const mainTextBox = document.createElement('div');
            mainTextBox.className = 'main-text-box';
            
            const label = document.createElement('span');
            label.className = 'main-text-label';
            label.textContent = '„Äê‰∏ªÊñá„Äë';
            
            const text = document.createElement('p');
            text.textContent = data.content.main_text;

            mainTextBox.appendChild(label);
            mainTextBox.appendChild(text);
            container.appendChild(mainTextBox);
        }

        // 3. Facts (‰∫ãÂØ¶) - Êñ∞Â¢ûÂçÄÂ°ä
        if (data.content && data.content.facts) {
            const factsBox = document.createElement('div');
            factsBox.className = 'main-text-box';
            factsBox.style.backgroundColor = '#f0f7ff'; // ÂçÄÂà•Êñº‰∏ªÊñáÁöÑÊ∑°ËóçËâ≤
            factsBox.style.borderLeftColor = '#3498db';
            
            const label = document.createElement('span');
            label.className = 'main-text-label';
            label.style.color = '#3498db';
            label.textContent = '„Äê‰∫ãÂØ¶„Äë';
            
            const text = document.createElement('p');
            text.style.whiteSpace = 'pre-wrap';
            text.textContent = data.content.facts;

            factsBox.appendChild(label);
            factsBox.appendChild(text);
            container.appendChild(factsBox);
        }

        // 4. Reasoning (ÁêÜÁî±) Structure
        const contentSection = document.createElement('div');
        contentSection.className = 'content-section';
        
        if (data.structured_reasoning && data.structured_reasoning.length > 0) {
            renderReasoningRecursively(data.structured_reasoning, contentSection);
        } else if (data.content && data.content.reasoning) {
            const p = document.createElement('p');
            p.className = 'text-paragraph';
            p.style.whiteSpace = 'pre-wrap';
            p.textContent = data.content.reasoning;
            contentSection.appendChild(p);
        } else if (data.content && data.content.full_text) {
            const p = document.createElement('p');
            p.className = 'text-paragraph';
            p.style.whiteSpace = 'pre-wrap';
            p.textContent = data.content.full_text;
            contentSection.appendChild(p);
        } else {
             const p = document.createElement('p');
             p.textContent = "(ÁÑ°ÂÖßÂÆπË≥áÊñô)";
             contentSection.appendChild(p);
        }

        container.appendChild(contentSection);

        // 5. Tables
        if (data.tables && data.tables.length > 0) {
            renderTables(data.tables, container);
        }

        // 6. Update Metadata Bar
        renderMetadata(data.metadata || {});
    }

    // --- Sidebar & Search Functions ---

    function highlightText(text, term) {
        if (!term) return text;
        const regex = new RegExp(`(${term})`, 'gi');
        return text.replace(regex, '<span class="highlight">$1</span>');
    }

    function renderSidebar(cases, searchTerm = '') {
        caseListEl.innerHTML = '';
        
        if (cases.length === 0) {
            caseListEl.innerHTML = '<div class="empty-state">Êü•ÁÑ°Áõ∏ÈóúÊ°à‰ª∂</div>';
            return;
        }

        cases.forEach(item => {
            const el = document.createElement('div');
            el.className = 'case-item';
            el.dataset.id = item.id;
            
            let caseNo = item.metadata.case_no || '';
            let subject = item.metadata.subject || item.filename;
            
            el.innerHTML = `
                <div class="case-id">${caseNo}</div>
                <div class="case-subject">${subject}</div>
            `;
            
            el.addEventListener('click', () => {
                document.querySelectorAll('.case-item').forEach(c => c.classList.remove('active'));
                el.classList.add('active');
                renderDocument(item);
            });
            
            caseListEl.appendChild(el);
        });
    }

    function filterCases(term) {
        const lowerTerm = term.toLowerCase().trim();
        if (!lowerTerm) {
            renderSidebar(allCases);
            return;
        }

        const filtered = allCases.filter(item => {
            const no = (item.metadata.case_no || '').toLowerCase();
            const subj = (item.metadata.subject || '').toLowerCase();
            const applicant = (item.metadata.applicant || '').toLowerCase();
            const fname = (item.filename || '').toLowerCase();
            const fullText = (item.content && item.content.full_text) ? item.content.full_text.toLowerCase() : '';
            
            return no.includes(lowerTerm) || 
                   subj.includes(lowerTerm) || 
                   applicant.includes(lowerTerm) ||
                   fname.includes(lowerTerm) ||
                   fullText.includes(lowerTerm); // ÂÖ®ÊñáÊ™¢Á¥¢
        });

        renderSidebar(filtered, lowerTerm);
    }

    // --- Init ---
    
    // Check if data loaded
    if (window.DECISIONS_DATA) {
        allCases = window.DECISIONS_DATA;
        renderSidebar(allCases);
        
        // Auto-select first case
        if (allCases.length > 0) {
             const firstItem = document.querySelector('.case-item');
             if (firstItem) firstItem.click();
        }
    } else {
        caseListEl.innerHTML = '<div class="empty-state">ÁÑ°Ê≥ïËºâÂÖ•Ë≥áÊñôÊ™îÊ°à (decision_data.js)</div>';
    }

    // Search Listener
    searchInput.addEventListener('input', (e) => {
        filterCases(e.target.value);
    });

</script>

</body>
</html>